<html>

<head>
<!-- HTML -->
<title>Covid-19 Tracker</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet"

<!-- Resources -->
<script src="https://cdn.amcharts.com/lib/4/core.js"></script>
<script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
<script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>

<!-- Styles -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class = row style="margin-bottom:0">
  <div class="col-12">
    <ul>
      <li><a class="active" href="http://localhost:5000">Home</a></li>
    </ul>    
  </div>
</div>

<section>
  <div id="h1">
    <h1> Covid-19 Global Tracker </h1>
  </div>
</section>

<section>
  <div class="col-md-12" id="md-date" style= "background: whitesmoke;color: grey">
    <form action="http://localhost:5000/result" method = "POST">
      <label for="dates">Choose a date:</label>
      <select name="selectdate">
        {% for d in dates %}
        <option value={{d}} selected>{{d}}</option>
        {% endfor %}
      </select>
      <input type="submit" value="Submit">
    </form>
      <p>Current Date Selected: {{dateselected}}</p>
  </div>
</section>
  
  <div class = row style= "height: 400px; margin-top: 20px; background: whitesmoke">
    <div class=col-6>
      <h5 style = "color: grey">Top Ten Countries with Highest Number of Cases per Day</h5>
      <div id="chartdiv1" width="500" height="700"></div>
    </div>
    <div class=col-6>
      <h5 style = "color: grey">Top Ten Countries with Highest Number of New Cases per Day</h5>
      <div id="chartdiv2" width="500" height="700"></div>
    </div>
  </div>

</body>
</html>

<!-- Chart code for 1st graph -->
<script>
  am4core.ready(function() {
  
  // Themes begin
  am4core.useTheme(am4themes_animated);
  // Themes end
  
  var chart = am4core.create("chartdiv1", am4charts.XYChart);
  chart.hiddenState.properties.opacity = 0; // this creates initial fade-in
  
  chart.data = {{result1 | safe}};
  
  console.log(chart.data)
  
  var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
  categoryAxis.renderer.grid.template.location = 0;
  categoryAxis.dataFields.category = "location";
  categoryAxis.renderer.minGridDistance = 40;
  categoryAxis.fontSize = 11;
  categoryAxis.title.text = "Tope 20 Countries with Highest Number of Cases";
  
  var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
  valueAxis.Min = 0;
  valueAxis.Max = 7000000;
  valueAxis.strictMinMax = true;
  valueAxis.renderer.minGridDistance = 30;
  valueAxis.title.text = "Total Cases By the Date";
  // axis break
  var axisBreak = valueAxis.axisBreaks.create();
  axisBreak.startValue = 500000;
  axisBreak.endValue = 5000000;
  //axisBreak.breakSize = 0.005;
  
  // fixed axis break
  var d = (axisBreak.endValue - axisBreak.startValue) / (valueAxis.Max - valueAxis.Min);
  axisBreak.breakSize = 0.05 * (1 - d) / d; // 0.05 means that the break will take 5% of the total value axis height
  
  // make break expand on hover
  var hoverState = axisBreak.states.create("hover");
  hoverState.properties.breakSize = 1;
  hoverState.properties.opacity = 0.1;
  hoverState.transitionDuration = 1500;
  
  axisBreak.defaultState.transitionDuration = 1000;
  /*
  // this is exactly the same, but with events
  axisBreak.events.on("over", function() {
    axisBreak.animate(
      [{ property: "breakSize", to: 1 }, { property: "opacity", to: 0.1 }],
      1500,
      am4core.ease.sinOut
    );
  });
  axisBreak.events.on("out", function() {
    axisBreak.animate(
      [{ property: "breakSize", to: 0.005 }, { property: "opacity", to: 1 }],
      1000,
      am4core.ease.quadOut
    );
  });*/
  
  var series = chart.series.push(new am4charts.CurvedColumnSeries());
  series.dataFields.categoryX = "location";
  series.dataFields.valueY = "total_cases";
  series.columns.template.tooltipText = "{valueY.value}";
  series.columns.template.tooltipY = 0;
  series.columns.template.strokeOpacity = 0;
  
  // as by default columns of the same series are of the same color, we add adapter which takes colors from chart.colors color set
  series.columns.template.adapter.add("fill", function(fill, target) {
    return chart.colors.getIndex(target.dataItem.index);
  });
  
  }); // end am4core.ready()
  </script>

<!-- Chart code for 2nd graph -->
<script>
  am4core.ready(function() {
  
  // Themes begin
  am4core.useTheme(am4themes_animated);
  // Themes end
  
  var chart = am4core.create("chartdiv2", am4charts.XYChart);
  chart.hiddenState.properties.opacity = 0; // this creates initial fade-in
  
  chart.data = {{result2 | safe}};
  
  console.log(chart.data)
  
  var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
  categoryAxis.renderer.grid.template.location = 0;
  categoryAxis.dataFields.category = "location";
  categoryAxis.renderer.minGridDistance = 40;
  categoryAxis.fontSize = 11;
  categoryAxis.title.text = "Tope 20 Countries with Highest Number of New Cases";
  
  var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
  valueAxis.Min = 0;
  valueAxis.Max = 700000;
  valueAxis.strictMinMax = true;
  valueAxis.renderer.minGridDistance = 30;
  valueAxis.title.text = "New Cases per Day";
  // axis break
  var axisBreak = valueAxis.axisBreaks.create();
  axisBreak.startValue = 5000;
  axisBreak.endValue = 500000;
  //axisBreak.breakSize = 0.005;
  
  // fixed axis break
  var d = (axisBreak.endValue - axisBreak.startValue) / (valueAxis.Max - valueAxis.Min);
  axisBreak.breakSize = 0.05 * (1 - d) / d; // 0.05 means that the break will take 5% of the total value axis height
  
  // make break expand on hover
  var hoverState = axisBreak.states.create("hover");
  hoverState.properties.breakSize = 1;
  hoverState.properties.opacity = 0.1;
  hoverState.transitionDuration = 1500;
  
  axisBreak.defaultState.transitionDuration = 1000;
  /*
  // this is exactly the same, but with events
  axisBreak.events.on("over", function() {
    axisBreak.animate(
      [{ property: "breakSize", to: 1 }, { property: "opacity", to: 0.1 }],
      1500,
      am4core.ease.sinOut
    );
  });
  axisBreak.events.on("out", function() {
    axisBreak.animate(
      [{ property: "breakSize", to: 0.005 }, { property: "opacity", to: 1 }],
      1000,
      am4core.ease.quadOut
    );
  });*/
  
  var series = chart.series.push(new am4charts.ColumnSeries());
  series.dataFields.categoryX = "location";
  series.dataFields.valueY = "new_cases";
  series.columns.template.tooltipText = "{valueY.value}";
  series.columns.template.tooltipY = 0;
  series.columns.template.strokeOpacity = 0;
  
  // as by default columns of the same series are of the same color, we add adapter which takes colors from chart.colors color set
  series.columns.template.adapter.add("fill", function(fill, target) {
    return chart.colors.getIndex(target.dataItem.index);
  });
  
  }); // end am4core.ready()
  </script>